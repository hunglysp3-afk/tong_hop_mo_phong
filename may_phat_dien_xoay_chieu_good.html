<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AC Generator Simulator - Pro Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #2c3e50; --accent: #e74c3c; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f4f7f6; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        .app-container { display: grid; grid-template-columns: 1fr 340px; grid-template-rows: 1fr 260px; gap: 12px; padding: 12px; flex: 1; }
        .simulation-area { background: white; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border: 1px solid #ddd; position: relative; }
        #simCanvas { width: 100%; height: 100%; }
        .control-panel { background: white; padding: 18px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); grid-row: 1 / 3; grid-column: 2; overflow-y: auto; border: 1px solid #ddd; }
        .observation-area { background: white; border-radius: 12px; padding: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); grid-column: 1; display: grid; grid-template-columns: 1fr 280px; gap: 15px; border: 1px solid #ddd; }
        .chart-container { position: relative; height: 100%; }
        .mode-btn { width: 100%; padding: 10px; margin-bottom: 6px; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; text-align: left; background: #fff; font-weight: bold; }
        .mode-btn.active { background: var(--primary); color: white; }
        .formula-card { background: #f8f9fa; padding: 10px; border-radius: 8px; font-size: 13px; border-left: 4px solid var(--primary); }
        .val-highlight { color: #d35400; font-weight: bold; font-family: monospace; }
        .instant-val { color: #2980b9; font-weight: bold; font-family: monospace; }
        input[type="range"] { width: 100%; margin: 8px 0; cursor: pointer; }
canvas, input[type="range"] {
    touch-action: none; /* NgƒÉn tr√¨nh duy·ªát cu·ªôn trang khi ƒëang thao t√°c tr√™n canvas ho·∫∑c slider */
}

@media (max-width: 600px) {
    .app-container {
        display: flex;
        flex-direction: column;
        height: auto; /* Cho ph√©p cu·ªôn trang theo chi·ªÅu d·ªçc tr√™n ƒëi·ªán tho·∫°i */
        overflow-y: scroll;
    }
    .simulation-area {
        height: 300px; /* C·ªë ƒë·ªãnh chi·ªÅu cao v√πng m√¥ ph·ªèng tr√™n mobile */
    }
    .control-panel {
        width: 100%;
        box-sizing: border-box;
    }
}    

</style>
</head>
<body>

<div class="app-container">
    <div class="simulation-area"><canvas id="simCanvas"></canvas></div>

    <div class="control-panel">
        <h3 style="margin-top:0; font-size:16px;">üöÄ Ch·∫ø ƒë·ªô h·ªçc t·∫≠p</h3>
        <button class="mode-btn active" id="m1">1. Quan s√°t (œâ, N)</button>
        <button class="mode-btn" id="m2">2. Th√≠ nghi·ªám (Hi·ªán ƒë·ªì th·ªã e)</button>
        <button class="mode-btn" id="m3">3. Kh√°m ph√° (M·ªü kh√≥a B, S)</button>
        <hr>
        <label style="font-size:12px; font-weight:bold;">T·ªëc ƒë·ªô œâ: <span id="txtW">0.03</span></label>
        <input type="range" id="rangeW" min="0.01" max="0.1" step="0.005" value="0.03">
        
        <label style="font-size:12px; font-weight:bold;">S·ªë v√≤ng d√¢y N: <span id="txtN">100</span></label>
        <input type="range" id="rangeN" min="50" max="400" step="10" value="100">

        <div id="extraSliders" style="display:none; border-top:1px dashed #ccc; padding-top:10px; margin-top:10px;">
            <label style="font-size:12px; font-weight:bold;">C·∫£m ·ª©ng t·ª´ B:</label>
            <input type="range" id="rangeB" min="0.5" max="2.5" step="0.1" value="1">
            <label style="font-size:12px; font-weight:bold;">Di·ªán t√≠ch S:</label>
            <input type="range" id="rangeS" min="0.5" max="2.0" step="0.1" value="1">
        </div>
        
        <button id="playBtn" style="width:100%; margin-top:15px; padding:12px; background:var(--accent); color:white; border:none; border-radius:8px; cursor:pointer; font-weight:bold;">T·∫†M D·ª™NG</button>
    </div>

    <div class="observation-area">
        <div class="chart-container"><canvas id="chartCanvas"></canvas></div>
        <div class="formula-card">
            <b>D·ªØ li·ªáu h·ªçc thu·∫≠t:</b><br>
            <div id="academicData" style="margin-top:8px; line-height:1.6;"></div>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('simCanvas');
    const ctx = canvas.getContext('2d');
    const chartCtx = document.getElementById('chartCanvas').getContext('2d');

    let angle = 0, omega = 0.03, B = 1, S = 1, N = 100, mode = 1, isRunning = true;
    let dataE = [], dataPhi = [], labels = [];
    let chart;

    function initChart() {
        chart = new Chart(chartCtx, {
            type: 'line',
            data: { labels: labels, datasets: [
                { label: 'e (V)', data: dataE, borderColor: '#f1c40f', borderWidth: 2, pointRadius: 0, fill: false },
                { label: 'Œ¶ (Wb)', data: dataPhi, borderColor: '#e74c3c', borderWidth: 2, pointRadius: 0, fill: false, hidden: true }
            ]},
            options: {
                responsive: true, maintainAspectRatio: false, animation: false,
                scales: {
                    y: { 
                        grid: { color: (c) => c.tick.value === 0 ? '#000' : '#eee', lineWidth: (c) => c.tick.value === 0 ? 2 : 1 }
                    },
                    x: { display: false }
                }
            }
        });
    }

    function drawMagnet3D(x, y, label, color, isRight) {
        const w = 80, h = 180, d = 25;
        ctx.fillStyle = color === "#e74c3c" ? "#c0392b" : "#2980b9";
        ctx.beginPath();
        if(!isRight) { ctx.moveTo(x+w, y-h/2); ctx.lineTo(x+w+d, y-h/2-10); ctx.lineTo(x+w+d, y+h/2-10); ctx.lineTo(x+w, y+h/2); }
        else { ctx.moveTo(x, y-h/2); ctx.lineTo(x-d, y-h/2-10); ctx.lineTo(x-d, y+h/2-10); ctx.lineTo(x, y+h/2); }
        ctx.fill();
        ctx.fillStyle = color; ctx.fillRect(x, y-h/2, w, h);
        ctx.fillStyle = "white"; ctx.font = "bold 30px Arial"; ctx.fillText(label, x+25, y+10);
    }

    // H√ÄM V·∫º V√ÄNH KHUY√äN (SLIP RINGS)
    function drawRing(x, y, r, color) {
        ctx.strokeStyle = color;
        ctx.lineWidth = 4;
        ctx.beginPath();
        ctx.ellipse(x, y, r, r/3, 0, 0, Math.PI * 2);
        ctx.stroke();
        // Ch·ªïi qu√©t (Brushes)
        ctx.fillStyle = "#34495e";
        ctx.fillRect(x + r, y - 2, 12, 5);
    }

    function render() {
        if (canvas.width !== canvas.clientWidth) { canvas.width = canvas.clientWidth; canvas.height = canvas.clientHeight; }
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const cx = canvas.width/2 - 60, cy = canvas.height/2 - 30;

        let phiMax = B * S;
        let e0 = (N * B * S * omega); 
        let drawPhiMax = phiMax * 2;
        let drawE0 = e0 * 0.8;

        let phi = phiMax * Math.cos(angle);
        let e_val = e0 * Math.sin(angle);

        // ƒê∆∞·ªùng s·ª©c t·ª´ ƒë·ªè khi Phi Max
        ctx.strokeStyle = Math.abs(phi) > (phiMax * 0.97) ? "#e74c3c" : "#dfe6e9";
        ctx.setLineDash([10, 5]);
        for(let i=-2; i<=2; i++) {
            ctx.beginPath(); ctx.moveTo(cx-150, cy+i*35); ctx.lineTo(cx+220, cy+i*35); ctx.stroke();
        }
        ctx.setLineDash([]);

        drawMagnet3D(cx - 220, cy, "N", "#e74c3c", false);
        drawMagnet3D(cx + 220, cy, "S", "#3498db", true);
        
        const fw = 160 * S, fh = 110;
        let viewW = Math.sin(angle);
        let p3 = { x: cx + (fw/2)*viewW, y: cy + fh/2 }, p4 = { x: cx - (fw/2)*viewW, y: cy + fh/2 };
        let p1 = { x: p4.x, y: p4.y - fh }, p2 = { x: p3.x, y: p3.y - fh };

        // V·∫Ω tr·ª•c quay
        ctx.strokeStyle = "#95a5a6"; ctx.lineWidth = 4;
        ctx.beginPath(); ctx.moveTo(cx, cy-120); ctx.lineTo(cx, cy+180); ctx.stroke();

        // V·∫Ω khung d√¢y
        ctx.strokeStyle = "#d35400"; ctx.lineWidth = 5;
        ctx.beginPath(); ctx.moveTo(p1.x, p1.y); ctx.lineTo(p2.x, p2.y); ctx.lineTo(p3.x, p3.y); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(p1.x, p1.y); ctx.lineTo(p4.x, p4.y); ctx.stroke();

        // M·∫°ch ƒëi·ªán n·ªëi ƒë√®n
        const ry1 = cy + 115, ry2 = cy + 145, r = 16;
        let a1 = { x: cx + r*Math.cos(angle + 1.57), y: ry1 + (r/3)*Math.sin(angle + 1.57) };
        let a2 = { x: cx + r*Math.cos(angle - 1.57), y: ry2 + (r/3)*Math.sin(angle - 1.57) };

        // D√¢y n·ªëi
        ctx.strokeStyle = "#000"; ctx.lineWidth = 2.5;
        ctx.beginPath(); ctx.moveTo(p4.x, p4.y); ctx.quadraticCurveTo(p4.x, p4.y+20, a1.x, a1.y); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(p3.x, p3.y); ctx.quadraticCurveTo(p3.x, p3.y+40, a2.x, a2.y); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(cx+r, ry1); ctx.lineTo(cx+160, ry1); ctx.lineTo(cx+160, cy+60); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(cx+r, ry2); ctx.lineTo(cx+140, ry2); ctx.lineTo(cx+140, cy+60); ctx.stroke();

        // V√ÄNH KHUY√äN (V·∫Ω sau ƒë·ªÉ ƒë√® l√™n d√¢y)
        drawRing(cx, ry1, r, "#f1c40f");
        drawRing(cx, ry2, r, "#f39c12");

        // --- LOGIC B√ìNG ƒê√àN TH√îNG MINH ---
// ƒê·ªô s√°ng t·ª©c th·ªùi t·ªâ l·ªá v·ªõi sin(angle), nh∆∞ng c∆∞·ªùng ƒë·ªô tr·∫ßn t·ªâ l·ªá v·ªõi e0
let brightness = Math.abs(Math.sin(angle)) * (e0 / 4); 

// T·∫°o m√†u v√†ng tr·∫Øng n·∫øu ƒëi·ªán √°p e0 cao
ctx.fillStyle = `rgba(255, 255, ${e0 > 3 ? 150 : 0}, ${Math.min(brightness, 1)})`;

// Th√™m hi·ªáu ·ª©ng h√†o quang (Glow)
ctx.shadowBlur = brightness * 15; 
ctx.shadowColor = "yellow";

ctx.beginPath(); 
ctx.arc(cx + 150, cy + 40, 20, 0, Math.PI * 2); 
ctx.fill();

// T·∫Øt hi·ªáu ·ª©ng ƒë·ªï b√≥ng ƒë·ªÉ kh√¥ng ·∫£nh h∆∞·ªüng ƒë·∫øn c√°c h√¨nh v·∫Ω sau ƒë√≥
ctx.shadowBlur = 0; 
ctx.strokeStyle = "#000"; 
ctx.stroke();
        // C·∫≠p nh·∫≠t tr·ª•c Oy ƒë·ªông
        if(chart && mode > 1) {
            let currentMax = mode === 3 ? Math.max(drawE0, drawPhiMax * 3) : drawE0;
            chart.options.scales.y.min = -(currentMax * 1.25);
            chart.options.scales.y.max = currentMax * 1.25;
        }

        // ƒê·ªì th·ªã v√† c·∫≠p nh·∫≠t d·ªØ li·ªáu
        if(isRunning) {
            angle += omega;
            if(mode > 1) {
                labels.push(""); 
                dataE.push(drawE0 * Math.sin(angle)); 
                dataPhi.push(drawPhiMax * Math.cos(angle) * 3); 
                let limit = Math.floor(31.4 / omega);
                if(labels.length > limit) { labels.shift(); dataE.shift(); dataPhi.shift(); }
                chart.update();
            }
        }

        // C·∫¨P NH·∫¨T GI√Å TR·ªä T·ª®C TH·ªúI TRONG B·∫¢NG
       const academicBox = document.getElementById('academicData');
if (mode === 1) {
    academicBox.innerHTML = `Œ¶ bi·∫øn thi√™n t·∫°o d√≤ng ƒëi·ªán.<br><b>E‚ÇÄ hi·ªán t·∫°i: ${e0.toFixed(2)}V</b>`;
} else {
    // Hi·ªÉn th·ªã c·∫£ gi√° tr·ªã C·ª±c ƒë·∫°i v√† gi√° tr·ªã T·ª©c th·ªùi (t)
    academicBox.innerHTML = 
        `Œ¶<sub>max</sub>: <span class="val-highlight">${phiMax.toFixed(2)}</span> Wb<br>` +
        `E‚ÇÄ: <span class="val-highlight">${e0.toFixed(2)}</span> V<br>` +
        `<hr>` +
        `Œ¶<sub>(t)</sub>: <b style="color:#2980b9">${phi.toFixed(3)}</b> Wb<br>` +
        `e<sub>(t)</sub>: <b style="color:#2980b9">${e_val.toFixed(3)}</b> V<br>` +
        `<hr>` +
        `Œ¶ = ${phiMax.toFixed(2)}.cos(œât)<br>e = ${e0.toFixed(2)}.sin(œât)`;
}

        requestAnimationFrame(render);
    }

    const setMode = (m) => {
        mode = m;
        document.querySelectorAll('.mode-btn').forEach((b, i) => b.classList.toggle('active', i+1 === m));
        document.getElementById('extraSliders').style.display = m === 3 ? 'block' : 'none';
        dataE.length = 0; dataPhi.length = 0; labels.length = 0;
        if(chart) {
            chart.data.datasets[0].hidden = (m === 1);
            chart.data.datasets[1].hidden = (m < 3);
            chart.update();
        }
    };

    document.getElementById('m1').onclick = () => setMode(1);
    document.getElementById('m2').onclick = () => setMode(2);
    document.getElementById('m3').onclick = () => setMode(3);
    document.getElementById('rangeW').oninput = (e) => { omega = parseFloat(e.target.value); document.getElementById('txtW').innerText = omega; };
    document.getElementById('rangeN').oninput = (e) => { N = parseInt(e.target.value); document.getElementById('txtN').innerText = N; };
    document.getElementById('rangeB').oninput = (e) => B = parseFloat(e.target.value);
    document.getElementById('rangeS').oninput = (e) => S = parseFloat(e.target.value);
    document.getElementById('playBtn').onclick = function() { isRunning = !isRunning; this.innerText = isRunning ? "T·∫†M D·ª™NG" : "TI·∫æP T·ª§C"; };

    initChart(); setMode(1); render();
</script>
</body>
</html>